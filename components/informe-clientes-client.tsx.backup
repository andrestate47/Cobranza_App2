
"use client"

import { useState, useEffect } from "react"
import { Session } from "next-auth"
import Link from "next/link"
import { 
  ArrowLeft, 
  Calendar, 
  Users, 
  TrendingUp,
  TrendingDown,
  AlertTriangle,
  Clock,
  CheckCircle,
  XCircle,
  Eye,
  Phone,
  MapPin,
  DollarSign,
  RefreshCw,
  Filter,
  Search,
  Download,
  UserPlus,
  CreditCard,
  Target,
  AlertCircle
} from "lucide-react"
import { Button } from "@/components/ui/button"
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"
import { Badge } from "@/components/ui/badge"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { useToast } from "@/hooks/use-toast"

interface InformeClientes {
  fecha: string
  resumen: {
    totalClientes: number
    totalPrestamos: number
    clientesVisitadosHoy: number
    clientesNoVisitadosHoy: number
    prestamosVencidos: number
    nuevosClientesHoy: number
    nuevosPrestamosHoy: number
    cobrosHoy: number
    totalCobradoHoy: number
    clientesConMora: number
    prestamosCancelados: number
    prestamosNuevosHoyCount: number
    prestamosVencidosCount: number
    prestamosEnMora: number
  }
  detalles: {
    clientesVisitados: Array<{
      id: string
      nombre: string
      documento: string
      telefono?: string
      direccion?: string
      ultimaVisita: string | null
      visitadoPor: string | null
      tipoVisita: string | null
      observaciones: string | null
      prestamosActivos: number
      totalPrestado: number
      totalPagado: number
      saldoPendiente: number
      prestamosVencidos: number
      diasMora: number
    }>
    clientesNoVisitados: Array<{
      id: string
      nombre: string
      documento: string
      telefono?: string
      direccion?: string
      prestamosActivos: number
      montoTotal: number
      totalPrestado: number
      totalPagado: number
      saldoPendiente: number
      prestamosVencidos: number
      ultimaVisita: string | null
      diasSinVisita: number | null
      diasMora: number
    }>
    prestamosVencidos: Array<{
      id: string
      cliente: string
      documento: string
      telefono?: string
      direccion?: string
      monto: number
      valorCuota: number
      cuotas: number
      fechaVencimiento: string
      diasVencido: number
      totalPagado: number
      saldoPendiente: number
      cuotasPagadas: number
      porcentajePagado: string
      ultimoPago: string | null
    }>
    nuevosClientes: Array<{
      id: string
      nombre: string
      documento: string
      telefono?: string
      direccion?: string
      fechaRegistro: string
      totalPrestamos: number
      prestamosActivos: number
      tienePrestamo: boolean
      montoPrimerPrestamo: number | null
      tipoPagoPrimerPrestamo: string | null
      interesPrimerPrestamo: number | null
    }>
    nuevosPrestamos: Array<{
      id: string
      cliente: string
      documento: string
      telefono?: string
      direccion?: string
      monto: number
      interes: number
      tipoPago: string
      valorCuota: number
      cuotas: number
      fechaInicio: string
      fechaFin: string
      creadoPor: string
      totalPagado: number
      cuotasPagadas: number
      porcentajePagado: string
      pagosRealizados: number
    }>
    cobrosHoy: Array<{
      id: string
      cliente: string
      documento: string
      telefono?: string
      monto: number
      fecha: string
      prestamoId: string
      montoPrestamo: number
      valorCuota: number
      cuotasTotales: number
      totalPagado: number
      saldoPendiente: number
      cuotasPagadas: number
      porcentajePagado: string
      cobradoPor: string
      observaciones?: string
    }>
    clientesConMora: Array<{
      id: string
      nombre: string
      documento: string
      telefono?: string
      direccion?: string
      prestamosEnMora: number
      montoTotal: number
      totalPrestado: number
      totalPagado: number
      saldoPendiente: number
      diasMora: number
      ultimaVisita: string | null
      diasSinGestion: number | null
      cuotasVencidas: number
    }>
  }
}

interface InformeClientesClientProps {
  session: Session
}

export default function InformeClientesClient({ session }: InformeClientesClientProps) {
  const [informe, setInforme] = useState<InformeClientes | null>(null)
  const [loading, setLoading] = useState(true)
  const [activeTab, setActiveTab] = useState("resumen")
  const [fechaSeleccionada, setFechaSeleccionada] = useState(() => {
    return new Date().toISOString().split('T')[0]
  })
  const [filtroTexto, setFiltroTexto] = useState("")
  const { toast } = useToast()

  const fetchInforme = async (fecha: string) => {
    setLoading(true)
    try {
      const response = await fetch(`/api/informe-clientes?fecha=${fecha}`)
      if (response.ok) {
        const data = await response.json()
        setInforme(data)
      } else {
        toast({
          title: "Error",
          description: "No se pudo cargar el informe",
          variant: "destructive",
        })
      }
    } catch (error) {
      console.error("Error:", error)
      toast({
        title: "Error",
        description: "Error de conexión",
        variant: "destructive",
      })
    } finally {
      setLoading(false)
    }
  }

  useEffect(() => {
    fetchInforme(fechaSeleccionada)
  }, [fechaSeleccionada])

  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('es-CO', {
      style: 'currency',
      currency: 'COP',
      minimumFractionDigits: 0
    }).format(amount)
  }

  const formatDate = (dateString: string) => {
    return new Date(dateString).toLocaleDateString('es-CO', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    })
  }

  const formatDateTime = (dateString: string) => {
    return new Date(dateString).toLocaleString('es-CO', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    })
  }

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50">
        <div className="container-mobile py-4">
          <div className="flex items-center justify-center py-20">
            <RefreshCw className="h-8 w-8 animate-spin text-primary" />
          </div>
        </div>
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <div className="bg-white shadow-sm border-b">
        <div className="container-mobile">
          <div className="flex items-center justify-between h-16">
            <div className="flex items-center space-x-3">
              <Link href="/dashboard">
                <Button variant="ghost" size="sm">
                  <ArrowLeft className="h-4 w-4 mr-2" />
                  Volver
                </Button>
              </Link>
              <div>
                <h1 className="text-lg font-semibold text-gray-900">Informe de Clientes</h1>
              </div>
            </div>
            <Button
              variant="outline"
              size="sm"
              onClick={() => fetchInforme(fechaSeleccionada)}
            >
              <RefreshCw className="h-4 w-4 mr-2" />
              Actualizar
            </Button>
          </div>
        </div>
      </div>

      <div className="container-mobile py-6">
        {/* Selector de fecha */}
        <div className="mb-6 flex flex-col sm:flex-row gap-4">
          <div className="flex-1 max-w-xs">
            <Label htmlFor="fecha">Fecha del informe</Label>
            <Input
              id="fecha"
              type="date"
              value={fechaSeleccionada}
              onChange={(e) => setFechaSeleccionada(e.target.value)}
              className="mt-1"
            />
          </div>
          <div className="flex-1 max-w-xs">
            <Label htmlFor="filtro">Buscar en detalles</Label>
            <Input
              id="filtro"
              type="text"
              placeholder="Buscar cliente, documento..."
              value={filtroTexto}
              onChange={(e) => setFiltroTexto(e.target.value)}
              className="mt-1"
            />
          </div>
        </div>

        {informe && (
          <div className="space-y-6">
            {/* Header del informe */}
            <div className="text-center">
              <h2 className="text-2xl font-bold text-gray-900 mb-2">
                {formatDate(informe.fecha)}
              </h2>
            </div>

            {/* Tabs */}
            <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
              <TabsList className="grid w-full grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-8 gap-1 h-auto p-1">
                <TabsTrigger value="resumen" className="text-xs sm:text-sm px-2 py-2 h-auto">Resumen</TabsTrigger>
                <TabsTrigger value="visitados" className="text-xs sm:text-sm px-2 py-2 h-auto">Visitados</TabsTrigger>
                <TabsTrigger value="no-visitados" className="text-xs sm:text-sm px-2 py-2 h-auto">No Visitados</TabsTrigger>
                <TabsTrigger value="vencidos" className="text-xs sm:text-sm px-2 py-2 h-auto">Vencidos</TabsTrigger>
                <TabsTrigger value="nuevos" className="text-xs sm:text-sm px-2 py-2 h-auto">Nuevos</TabsTrigger>
                <TabsTrigger value="cobros" className="text-xs sm:text-sm px-2 py-2 h-auto">Cobros</TabsTrigger>
                <TabsTrigger value="mora" className="text-xs sm:text-sm px-2 py-2 h-auto">Con Mora</TabsTrigger>
                <TabsTrigger value="prestamos" className="text-xs sm:text-sm px-2 py-2 h-auto">Préstamos</TabsTrigger>
              </TabsList>

              {/* TAB RESUMEN */}
              <TabsContent value="resumen" className="space-y-6 mt-6">
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 lg:gap-6">
                  <Card className="animate-fadeInScale min-h-[120px] hover:shadow-lg transition-shadow">
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                      <CardTitle className="text-sm font-medium leading-tight">Total Clientes</CardTitle>
                      <Users className="h-5 w-5 text-blue-600 flex-shrink-0" />
                    </CardHeader>
                    <CardContent className="pt-0">
                      <div className="text-2xl font-bold text-blue-600">
                        {informe.resumen.totalClientes}
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="animate-fadeInScale min-h-[120px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.1s' }}>
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                      <CardTitle className="text-sm font-medium leading-tight">Préstamos Activos</CardTitle>
                      <CreditCard className="h-5 w-5 text-green-600 flex-shrink-0" />
                    </CardHeader>
                    <CardContent className="pt-0">
                      <div className="text-2xl font-bold text-green-600">
                        {informe.resumen.totalPrestamos}
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="animate-fadeInScale min-h-[120px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.2s' }}>
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                      <CardTitle className="text-sm font-medium leading-tight">Visitados Hoy</CardTitle>
                      <CheckCircle className="h-5 w-5 text-emerald-600 flex-shrink-0" />
                    </CardHeader>
                    <CardContent className="pt-0">
                      <div className="text-2xl font-bold text-emerald-600">
                        {informe.resumen.clientesVisitadosHoy}
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="animate-fadeInScale min-h-[120px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.3s' }}>
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                      <CardTitle className="text-sm font-medium leading-tight">No Visitados</CardTitle>
                      <XCircle className="h-5 w-5 text-orange-600 flex-shrink-0" />
                    </CardHeader>
                    <CardContent className="pt-0">
                      <div className="text-2xl font-bold text-orange-600">
                        {informe.resumen.clientesNoVisitadosHoy}
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="animate-fadeInScale min-h-[120px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.4s' }}>
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                      <CardTitle className="text-xs sm:text-sm font-medium leading-tight">
                        Préstamos<br className="sm:hidden" /><span className="hidden sm:inline"> </span>Vencidos
                      </CardTitle>
                      <AlertTriangle className="h-5 w-5 text-red-600 flex-shrink-0" />
                    </CardHeader>
                    <CardContent className="pt-0">
                      <div className="text-2xl font-bold text-red-600">
                        {informe.resumen.prestamosVencidos}
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="animate-fadeInScale min-h-[120px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.5s' }}>
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                      <CardTitle className="text-sm font-medium leading-tight">Nuevos Clientes</CardTitle>
                      <UserPlus className="h-5 w-5 text-purple-600 flex-shrink-0" />
                    </CardHeader>
                    <CardContent className="pt-0">
                      <div className="text-2xl font-bold text-purple-600">
                        {informe.resumen.nuevosClientesHoy}
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="animate-fadeInScale min-h-[120px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.6s' }}>
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                      <CardTitle className="text-sm font-medium leading-tight">Nuevos Préstamos</CardTitle>
                      <TrendingUp className="h-5 w-5 text-teal-600 flex-shrink-0" />
                    </CardHeader>
                    <CardContent className="pt-0">
                      <div className="text-2xl font-bold text-teal-600">
                        {informe.resumen.nuevosPrestamosHoy}
                      </div>
                    </CardContent>
                  </Card>

                  <Card className="animate-fadeInScale min-h-[120px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.7s' }}>
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                      <CardTitle className="text-sm font-medium leading-tight">Cobros Hoy</CardTitle>
                      <DollarSign className="h-5 w-5 text-green-600 flex-shrink-0" />
                    </CardHeader>
                    <CardContent className="pt-0">
                      <div className="text-2xl font-bold text-green-600">
                        {informe.resumen.cobrosHoy}
                      </div>
                      <p className="text-xs text-gray-600 mt-1">
                        {formatCurrency(informe.resumen.totalCobradoHoy)}
                      </p>
                    </CardContent>
                  </Card>

                  <Card className="animate-fadeInScale min-h-[120px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.8s' }}>
                    <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                      <CardTitle className="text-xs sm:text-sm font-medium leading-tight">
                        Clientes<br className="sm:hidden" /><span className="hidden sm:inline"> </span>Con Mora
                      </CardTitle>
                      <AlertCircle className="h-5 w-5 text-red-600 flex-shrink-0" />
                    </CardHeader>
                    <CardContent className="pt-0">
                      <div className="text-2xl font-bold text-red-600">
                        {informe.resumen.clientesConMora}
                      </div>
                    </CardContent>
                  </Card>
                </div>
              </TabsContent>

              {/* TAB CLIENTES VISITADOS */}
              <TabsContent value="visitados" className="space-y-4 mt-6">
                <div className="flex justify-between items-center">
                  <h3 className="text-lg font-semibold">Clientes Visitados Hoy</h3>
                  <Badge variant="secondary">{informe.detalles.clientesVisitados.length}</Badge>
                </div>
                <div className="space-y-3">
                  {informe.detalles.clientesVisitados
                    .filter(cliente => 
                      filtroTexto === "" || 
                      cliente.nombre.toLowerCase().includes(filtroTexto.toLowerCase()) ||
                      cliente.documento.includes(filtroTexto)
                    )
                    .map((cliente, index) => (
                    <Card key={cliente.id} className="animate-fadeInScale" style={{ animationDelay: `${index * 0.1}s` }}>
                      <CardContent className="p-4">
                        <div className="space-y-3">
                          {/* Encabezado del cliente */}
                          <div className="flex justify-between items-start">
                            <div className="flex-1">
                              <div className="flex items-center space-x-2 flex-wrap">
                                <h4 className="font-semibold text-gray-900">{cliente.nombre}</h4>
                                <Badge variant="outline" className="bg-green-50 text-green-700">
                                  <CheckCircle className="h-3 w-3 mr-1" />
                                  Visitado
                                </Badge>
                                {cliente.prestamosVencidos > 0 && (
                                  <Badge variant="destructive" className="text-xs">
                                    <AlertTriangle className="h-3 w-3 mr-1" />
                                    {cliente.prestamosVencidos} vencido{cliente.prestamosVencidos !== 1 ? 's' : ''}
                                  </Badge>
                                )}
                              </div>
                              <p className="text-sm text-gray-600">{cliente.documento}</p>
                              {cliente.telefono && (
                                <div className="flex items-center space-x-1 mt-1">
                                  <Phone className="h-3 w-3 text-gray-400" />
                                  <span className="text-sm text-gray-600">{cliente.telefono}</span>
                                </div>
                              )}
                              {cliente.direccion && (
                                <div className="flex items-center space-x-1 mt-1">
                                  <MapPin className="h-3 w-3 text-gray-400" />
                                  <span className="text-sm text-gray-600">{cliente.direccion}</span>
                                </div>
                              )}
                            </div>
                            <div className="text-right">
                              <Badge variant="secondary">
                                {cliente.prestamosActivos} préstamo{cliente.prestamosActivos !== 1 ? 's' : ''}
                              </Badge>
                            </div>
                          </div>

                          {/* Información financiera */}
                          <div className="grid grid-cols-2 md:grid-cols-4 gap-2 p-3 bg-gray-50 rounded-lg">
                            <div>
                              <p className="text-xs text-gray-500">Total Prestado</p>
                              <p className="text-sm font-semibold text-blue-600">
                                {formatCurrency(cliente.totalPrestado)}
                              </p>
                            </div>
                            <div>
                              <p className="text-xs text-gray-500">Total Pagado</p>
                              <p className="text-sm font-semibold text-green-600">
                                {formatCurrency(cliente.totalPagado)}
                              </p>
                            </div>
                            <div>
                              <p className="text-xs text-gray-500">Saldo Pendiente</p>
                              <p className="text-sm font-semibold text-orange-600">
                                {formatCurrency(cliente.saldoPendiente)}
                              </p>
                            </div>
                            <div>
                              <p className="text-xs text-gray-500">Porcentaje Pagado</p>
                              <p className="text-sm font-semibold text-purple-600">
                                {((cliente.totalPagado / cliente.totalPrestado) * 100).toFixed(1)}%
                              </p>
                            </div>
                          </div>

                          {/* Información de la visita */}
                          <div className="pt-2 border-t space-y-1">
                            {cliente.ultimaVisita && (
                              <p className="text-sm text-green-600">
                                <Clock className="h-3 w-3 inline mr-1" />
                                Visitado: {formatDateTime(cliente.ultimaVisita)}
                              </p>
                            )}
                            {cliente.visitadoPor && (
                              <p className="text-sm text-gray-600">
                                Por: {cliente.visitadoPor}
                              </p>
                            )}
                            {cliente.tipoVisita && (
                              <Badge variant="outline" className="text-xs">
                                {cliente.tipoVisita}
                              </Badge>
                            )}
                            {cliente.observaciones && (
                              <p className="text-sm text-gray-500 italic mt-1">
                                "{cliente.observaciones}"
                              </p>
                            )}
                            {cliente.diasMora > 0 && (
                              <p className="text-sm text-red-600 font-medium">
                                ⚠️ Mora de {cliente.diasMora} días
                              </p>
                            )}
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                  {informe.detalles.clientesVisitados.length === 0 && (
                    <Card>
                      <CardContent className="p-8 text-center text-gray-500">
                        <Eye className="h-12 w-12 mx-auto mb-4 text-gray-400" />
                        No hay clientes visitados hoy
                      </CardContent>
                    </Card>
                  )}
                </div>
              </TabsContent>

              {/* TAB CLIENTES NO VISITADOS */}
              <TabsContent value="no-visitados" className="space-y-4 mt-6">
                <div className="flex justify-between items-center">
                  <h3 className="text-lg font-semibold">Clientes No Visitados</h3>
                  <Badge variant="destructive">{informe.detalles.clientesNoVisitados.length}</Badge>
                </div>
                <div className="space-y-3">
                  {informe.detalles.clientesNoVisitados
                    .filter(cliente => 
                      filtroTexto === "" || 
                      cliente.nombre.toLowerCase().includes(filtroTexto.toLowerCase()) ||
                      cliente.documento.includes(filtroTexto)
                    )
                    .map((cliente, index) => (
                    <Card key={cliente.id} className="animate-fadeInScale border-l-4 border-l-orange-400" style={{ animationDelay: `${index * 0.1}s` }}>
                      <CardContent className="p-4">
                        <div className="flex justify-between items-start">
                          <div className="flex-1">
                            <div className="flex items-center space-x-2">
                              <h4 className="font-semibold text-gray-900">{cliente.nombre}</h4>
                              <Badge variant="destructive">
                                <XCircle className="h-3 w-3 mr-1" />
                                Pendiente
                              </Badge>
                            </div>
                            <p className="text-sm text-gray-600">{cliente.documento}</p>
                            {cliente.telefono && (
                              <div className="flex items-center space-x-1 mt-1">
                                <Phone className="h-3 w-3 text-gray-400" />
                                <span className="text-sm text-gray-600">{cliente.telefono}</span>
                              </div>
                            )}
                            {cliente.direccion && (
                              <div className="flex items-center space-x-1 mt-1">
                                <MapPin className="h-3 w-3 text-gray-400" />
                                <span className="text-sm text-gray-600">{cliente.direccion}</span>
                              </div>
                            )}
                          </div>
                          <div className="text-right">
                            <Badge variant="secondary">
                              {cliente.prestamosActivos} préstamo{cliente.prestamosActivos !== 1 ? 's' : ''}
                            </Badge>
                            <p className="text-sm font-semibold text-gray-900 mt-1">
                              {formatCurrency(cliente.montoTotal)}
                            </p>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                  {informe.detalles.clientesNoVisitados.length === 0 && (
                    <Card>
                      <CardContent className="p-8 text-center text-gray-500">
                        <CheckCircle className="h-12 w-12 mx-auto mb-4 text-green-400" />
                        ¡Excelente! Todos los clientes fueron visitados hoy
                      </CardContent>
                    </Card>
                  )}
                </div>
              </TabsContent>

              {/* TAB PRÉSTAMOS VENCIDOS */}
              <TabsContent value="vencidos" className="space-y-4 mt-6">
                <div className="flex justify-between items-center">
                  <h3 className="text-lg font-semibold">Préstamos Vencidos</h3>
                  <Badge variant="destructive">{informe.detalles.prestamosVencidos.length}</Badge>
                </div>
                <div className="space-y-3">
                  {informe.detalles.prestamosVencidos
                    .filter(prestamo => 
                      filtroTexto === "" || 
                      prestamo.cliente.toLowerCase().includes(filtroTexto.toLowerCase()) ||
                      prestamo.documento.includes(filtroTexto)
                    )
                    .map((prestamo, index) => (
                    <Card key={prestamo.id} className="animate-fadeInScale border-l-4 border-l-red-500" style={{ animationDelay: `${index * 0.1}s` }}>
                      <CardContent className="p-4">
                        <div className="flex justify-between items-start">
                          <div className="flex-1">
                            <div className="flex items-center space-x-2">
                              <h4 className="font-semibold text-gray-900">{prestamo.cliente}</h4>
                              <Badge variant="destructive">
                                <AlertTriangle className="h-3 w-3 mr-1" />
                                {prestamo.diasVencido} días vencido
                              </Badge>
                            </div>
                            <p className="text-sm text-gray-600">{prestamo.documento}</p>
                            {prestamo.telefono && (
                              <div className="flex items-center space-x-1 mt-1">
                                <Phone className="h-3 w-3 text-gray-400" />
                                <span className="text-sm text-gray-600">{prestamo.telefono}</span>
                              </div>
                            )}
                            {prestamo.direccion && (
                              <div className="flex items-center space-x-1 mt-1">
                                <MapPin className="h-3 w-3 text-gray-400" />
                                <span className="text-sm text-gray-600">{prestamo.direccion}</span>
                              </div>
                            )}
                            <p className="text-sm text-red-600 mt-1">
                              Venció: {new Date(prestamo.fechaVencimiento).toLocaleDateString('es-CO')}
                            </p>
                          </div>
                          <div className="text-right">
                            <p className="text-lg font-bold text-red-600">
                              {formatCurrency(prestamo.monto)}
                            </p>
                            <p className="text-sm text-gray-600">
                              Cuota: {formatCurrency(prestamo.valorCuota)}
                            </p>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                  {informe.detalles.prestamosVencidos.length === 0 && (
                    <Card>
                      <CardContent className="p-8 text-center text-gray-500">
                        <CheckCircle className="h-12 w-12 mx-auto mb-4 text-green-400" />
                        No hay préstamos vencidos
                      </CardContent>
                    </Card>
                  )}
                </div>
              </TabsContent>

              {/* TAB NUEVOS */}
              <TabsContent value="nuevos" className="space-y-4 mt-6">
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  {/* Nuevos Clientes */}
                  <div>
                    <div className="flex justify-between items-center mb-4">
                      <h3 className="text-lg font-semibold">Nuevos Clientes</h3>
                      <Badge variant="secondary">{informe.detalles.nuevosClientes.length}</Badge>
                    </div>
                    <div className="space-y-3 max-h-96 overflow-y-auto">
                      {informe.detalles.nuevosClientes.map((cliente, index) => (
                        <Card key={cliente.id} className="animate-fadeInScale" style={{ animationDelay: `${index * 0.1}s` }}>
                          <CardContent className="p-4">
                            <div className="flex items-center space-x-2">
                              <h4 className="font-semibold text-gray-900">{cliente.nombre}</h4>
                              <Badge variant="outline" className="bg-purple-50 text-purple-700">
                                <UserPlus className="h-3 w-3 mr-1" />
                                Nuevo
                              </Badge>
                            </div>
                            <p className="text-sm text-gray-600">{cliente.documento}</p>
                            {cliente.telefono && (
                              <div className="flex items-center space-x-1 mt-1">
                                <Phone className="h-3 w-3 text-gray-400" />
                                <span className="text-sm text-gray-600">{cliente.telefono}</span>
                              </div>
                            )}
                            <p className="text-sm text-purple-600 mt-1">
                              Registrado: {formatDateTime(cliente.fechaRegistro)}
                            </p>
                          </CardContent>
                        </Card>
                      ))}
                      {informe.detalles.nuevosClientes.length === 0 && (
                        <Card>
                          <CardContent className="p-6 text-center text-gray-500">
                            <UserPlus className="h-8 w-8 mx-auto mb-2 text-gray-400" />
                            No hay clientes nuevos hoy
                          </CardContent>
                        </Card>
                      )}
                    </div>
                  </div>

                  {/* Nuevos Préstamos */}
                  <div>
                    <div className="flex justify-between items-center mb-4">
                      <h3 className="text-lg font-semibold">Nuevos Préstamos</h3>
                      <Badge variant="secondary">{informe.detalles.nuevosPrestamos.length}</Badge>
                    </div>
                    <div className="space-y-3 max-h-96 overflow-y-auto">
                      {informe.detalles.nuevosPrestamos.map((prestamo, index) => (
                        <Card key={prestamo.id} className="animate-fadeInScale" style={{ animationDelay: `${index * 0.1}s` }}>
                          <CardContent className="p-4">
                            <div className="flex justify-between items-start">
                              <div className="flex-1">
                                <div className="flex items-center space-x-2">
                                  <h4 className="font-semibold text-gray-900">{prestamo.cliente}</h4>
                                  <Badge variant="outline" className="bg-teal-50 text-teal-700">
                                    <CreditCard className="h-3 w-3 mr-1" />
                                    Nuevo
                                  </Badge>
                                </div>
                                <p className="text-sm text-gray-600">{prestamo.documento}</p>
                                <p className="text-sm text-gray-600">
                                  Tipo: {prestamo.tipoPago} • Interés: {prestamo.interes}%
                                </p>
                                <p className="text-sm text-gray-500">
                                  Por: {prestamo.creadoPor}
                                </p>
                                <p className="text-sm text-teal-600 mt-1">
                                  {formatDateTime(prestamo.fechaInicio)}
                                </p>
                              </div>
                              <div className="text-right">
                                <p className="text-lg font-bold text-teal-600">
                                  {formatCurrency(prestamo.monto)}
                                </p>
                              </div>
                            </div>
                          </CardContent>
                        </Card>
                      ))}
                      {informe.detalles.nuevosPrestamos.length === 0 && (
                        <Card>
                          <CardContent className="p-6 text-center text-gray-500">
                            <CreditCard className="h-8 w-8 mx-auto mb-2 text-gray-400" />
                            No hay préstamos nuevos hoy
                          </CardContent>
                        </Card>
                      )}
                    </div>
                  </div>
                </div>
              </TabsContent>

              {/* TAB COBROS */}
              <TabsContent value="cobros" className="space-y-4 mt-6">
                <div className="flex justify-between items-center">
                  <h3 className="text-lg font-semibold">Cobros de Hoy</h3>
                  <div className="flex items-center space-x-2">
                    <Badge variant="secondary">{informe.detalles.cobrosHoy.length}</Badge>
                    <Badge variant="outline" className="bg-green-50 text-green-700">
                      {formatCurrency(informe.resumen.totalCobradoHoy)}
                    </Badge>
                  </div>
                </div>
                <div className="space-y-3">
                  {informe.detalles.cobrosHoy
                    .filter(cobro => 
                      filtroTexto === "" || 
                      cobro.cliente.toLowerCase().includes(filtroTexto.toLowerCase()) ||
                      cobro.documento.includes(filtroTexto)
                    )
                    .map((cobro, index) => (
                    <Card key={cobro.id} className="animate-fadeInScale border-l-4 border-l-green-400" style={{ animationDelay: `${index * 0.1}s` }}>
                      <CardContent className="p-4">
                        <div className="flex justify-between items-start">
                          <div className="flex-1">
                            <div className="flex items-center space-x-2">
                              <h4 className="font-semibold text-gray-900">{cobro.cliente}</h4>
                              <Badge variant="outline" className="bg-green-50 text-green-700">
                                <DollarSign className="h-3 w-3 mr-1" />
                                Cobro
                              </Badge>
                            </div>
                            <p className="text-sm text-gray-600">{cobro.documento}</p>
                            <p className="text-sm text-gray-500">
                              Por: {cobro.cobradoPor}
                            </p>
                            <p className="text-sm text-green-600">
                              {formatDateTime(cobro.fecha)}
                            </p>
                            {cobro.observaciones && (
                              <p className="text-sm text-gray-500 italic mt-1">
                                "{cobro.observaciones}"
                              </p>
                            )}
                          </div>
                          <div className="text-right">
                            <p className="text-lg font-bold text-green-600">
                              {formatCurrency(cobro.monto)}
                            </p>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                  {informe.detalles.cobrosHoy.length === 0 && (
                    <Card>
                      <CardContent className="p-8 text-center text-gray-500">
                        <DollarSign className="h-12 w-12 mx-auto mb-4 text-gray-400" />
                        No hay cobros registrados hoy
                      </CardContent>
                    </Card>
                  )}
                </div>
              </TabsContent>

              {/* TAB CLIENTES CON MORA */}
              <TabsContent value="mora" className="space-y-4 mt-6">
                <div className="flex justify-between items-center">
                  <h3 className="text-lg font-semibold">Clientes con Mora</h3>
                  <Badge variant="destructive">{informe.detalles.clientesConMora.length}</Badge>
                </div>
                <div className="space-y-3">
                  {informe.detalles.clientesConMora
                    .filter(cliente => 
                      filtroTexto === "" || 
                      cliente.nombre.toLowerCase().includes(filtroTexto.toLowerCase()) ||
                      cliente.documento.includes(filtroTexto)
                    )
                    .sort((a, b) => b.diasMora - a.diasMora)
                    .map((cliente, index) => (
                    <Card key={cliente.id} className="animate-fadeInScale border-l-4 border-l-red-500" style={{ animationDelay: `${index * 0.1}s` }}>
                      <CardContent className="p-4">
                        <div className="flex justify-between items-start">
                          <div className="flex-1">
                            <div className="flex items-center space-x-2">
                              <h4 className="font-semibold text-gray-900">{cliente.nombre}</h4>
                              <Badge variant="destructive">
                                <AlertCircle className="h-3 w-3 mr-1" />
                                {cliente.diasMora} días mora
                              </Badge>
                            </div>
                            <p className="text-sm text-gray-600">{cliente.documento}</p>
                            {cliente.telefono && (
                              <div className="flex items-center space-x-1 mt-1">
                                <Phone className="h-3 w-3 text-gray-400" />
                                <span className="text-sm text-gray-600">{cliente.telefono}</span>
                              </div>
                            )}
                            {cliente.direccion && (
                              <div className="flex items-center space-x-1 mt-1">
                                <MapPin className="h-3 w-3 text-gray-400" />
                                <span className="text-sm text-gray-600">{cliente.direccion}</span>
                              </div>
                            )}
                          </div>
                          <div className="text-right">
                            <Badge variant="outline" className="mb-2">
                              {cliente.prestamosEnMora} préstamo{cliente.prestamosEnMora !== 1 ? 's' : ''} en mora
                            </Badge>
                            <p className="text-lg font-bold text-red-600">
                              {formatCurrency(cliente.montoTotal)}
                            </p>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                  {informe.detalles.clientesConMora.length === 0 && (
                    <Card>
                      <CardContent className="p-8 text-center text-gray-500">
                        <CheckCircle className="h-12 w-12 mx-auto mb-4 text-green-400" />
                        No hay clientes con mora
                      </CardContent>
                    </Card>
                  )}
                </div>
              </TabsContent>

              {/* TAB PRÉSTAMOS DE CLIENTES */}
              <TabsContent value="prestamos" className="space-y-6 mt-6">
                <div>
                  <h3 className="text-lg font-semibold mb-6">Estadísticas de Préstamos</h3>
                  
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6">
                    {/* Total Préstamos */}
                    <Card className="animate-fadeInScale min-h-[140px] hover:shadow-lg transition-shadow">
                      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                        <CardTitle className="text-sm font-medium leading-tight">Total Préstamos</CardTitle>
                        <CreditCard className="h-5 w-5 text-blue-600 flex-shrink-0" />
                      </CardHeader>
                      <CardContent className="pt-0">
                        <div className="text-3xl font-bold text-blue-600">
                          {informe.resumen.totalPrestamos}
                        </div>
                        <p className="text-xs text-gray-600 mt-2">
                          Préstamos activos en el sistema
                        </p>
                      </CardContent>
                    </Card>

                    {/* Préstamos Nuevos */}
                    <Card className="animate-fadeInScale min-h-[140px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.1s' }}>
                      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                        <CardTitle className="text-sm font-medium leading-tight">Préstamos Nuevos</CardTitle>
                        <TrendingUp className="h-5 w-5 text-teal-600 flex-shrink-0" />
                      </CardHeader>
                      <CardContent className="pt-0">
                        <div className="text-3xl font-bold text-teal-600">
                          {informe.resumen.prestamosNuevosHoyCount}
                        </div>
                        <p className="text-xs text-gray-600 mt-2">
                          Préstamos creados hoy
                        </p>
                      </CardContent>
                    </Card>

                    {/* Préstamos Cancelados */}
                    <Card className="animate-fadeInScale min-h-[140px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.2s' }}>
                      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                        <CardTitle className="text-sm font-medium leading-tight">Préstamos Cancelados</CardTitle>
                        <CheckCircle className="h-5 w-5 text-green-600 flex-shrink-0" />
                      </CardHeader>
                      <CardContent className="pt-0">
                        <div className="text-3xl font-bold text-green-600">
                          {informe.resumen.prestamosCancelados}
                        </div>
                        <p className="text-xs text-gray-600 mt-2">
                          Préstamos completados totalmente
                        </p>
                      </CardContent>
                    </Card>

                    {/* Préstamos Vencidos */}
                    <Card className="animate-fadeInScale min-h-[140px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.3s' }}>
                      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                        <CardTitle className="text-sm font-medium leading-tight">Préstamos Vencidos</CardTitle>
                        <AlertTriangle className="h-5 w-5 text-orange-600 flex-shrink-0" />
                      </CardHeader>
                      <CardContent className="pt-0">
                        <div className="text-3xl font-bold text-orange-600">
                          {informe.resumen.prestamosVencidosCount}
                        </div>
                        <p className="text-xs text-gray-600 mt-2">
                          Préstamos con fecha vencida
                        </p>
                      </CardContent>
                    </Card>

                    {/* Préstamos en Mora */}
                    <Card className="animate-fadeInScale min-h-[140px] hover:shadow-lg transition-shadow" style={{ animationDelay: '0.4s' }}>
                      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                        <CardTitle className="text-sm font-medium leading-tight">Préstamos en Mora</CardTitle>
                        <AlertCircle className="h-5 w-5 text-red-600 flex-shrink-0" />
                      </CardHeader>
                      <CardContent className="pt-0">
                        <div className="text-3xl font-bold text-red-600">
                          {informe.resumen.prestamosEnMora}
                        </div>
                        <p className="text-xs text-gray-600 mt-2">
                          Préstamos activos en mora
                        </p>
                      </CardContent>
                    </Card>

                    {/* Tarjeta de resumen adicional */}
                    <Card className="animate-fadeInScale min-h-[140px] hover:shadow-lg transition-shadow bg-gradient-to-br from-blue-50 to-indigo-50" style={{ animationDelay: '0.5s' }}>
                      <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-3">
                        <CardTitle className="text-sm font-medium leading-tight">Estado General</CardTitle>
                        <Target className="h-5 w-5 text-indigo-600 flex-shrink-0" />
                      </CardHeader>
                      <CardContent className="pt-0">
                        <div className="space-y-2">
                          <div className="flex justify-between items-center">
                            <span className="text-xs text-gray-600">Activos:</span>
                            <span className="text-sm font-semibold text-blue-600">{informe.resumen.totalPrestamos}</span>
                          </div>
                          <div className="flex justify-between items-center">
                            <span className="text-xs text-gray-600">Vencidos:</span>
                            <span className="text-sm font-semibold text-orange-600">{informe.resumen.prestamosVencidosCount}</span>
                          </div>
                          <div className="flex justify-between items-center">
                            <span className="text-xs text-gray-600">En Mora:</span>
                            <span className="text-sm font-semibold text-red-600">{informe.resumen.prestamosEnMora}</span>
                          </div>
                          <div className="flex justify-between items-center pt-2 border-t">
                            <span className="text-xs font-medium text-gray-700">Completados:</span>
                            <span className="text-sm font-bold text-green-600">{informe.resumen.prestamosCancelados}</span>
                          </div>
                        </div>
                      </CardContent>
                    </Card>
                  </div>
                </div>

                {/* Información adicional */}
                <Card className="bg-blue-50 border-blue-200">
                  <CardContent className="p-6">
                    <div className="flex items-start space-x-3">
                      <div className="flex-shrink-0">
                        <CreditCard className="h-6 w-6 text-blue-600" />
                      </div>
                      <div className="flex-1">
                        <h4 className="text-sm font-semibold text-blue-900 mb-2">Información sobre Préstamos</h4>
                        <div className="text-sm text-blue-800 space-y-2">
                          <p>
                            <strong>Total de Préstamos:</strong> Muestra todos los préstamos activos en el sistema.
                          </p>
                          <p>
                            <strong>Préstamos Nuevos:</strong> Préstamos que fueron creados en la fecha seleccionada.
                          </p>
                          <p>
                            <strong>Préstamos Cancelados:</strong> Préstamos que han sido completados totalmente (estado CANCELADO).
                          </p>
                          <p>
                            <strong>Préstamos Vencidos:</strong> Préstamos activos cuya fecha de finalización ya pasó.
                          </p>
                          <p>
                            <strong>Préstamos en Mora:</strong> Total de préstamos de clientes que tienen al menos un préstamo vencido.
                          </p>
                        </div>
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </TabsContent>
            </Tabs>
          </div>
        )}
      </div>
    </div>
  )
}
